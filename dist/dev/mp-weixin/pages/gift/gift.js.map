{"version":3,"file":"gift.js","sources":["../../../../../src/pages/gift/gift.vue","../../../../../uniPage:/cGFnZXMvZ2lmdC9naWZ0LnZ1ZQ"],"sourcesContent":["<template>\n  <div :style=\"{ paddingBottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\n    <view class=\"ad_popError\" v-if=\"mycredit == 0\">您的积分为零</view>\n    <!-- <swiper\n      :indicator-dots=\"indicatorDots\"\n      :autoplay=\"autoplay\"\n      :interval=\"interval\"\n      :duration=\"duration\"\n    > -->\n    <!-- <swiper-item v-for=\"(url, index) in goodsdata.imgs\" :key=\"index\"> :data-src=\"url\" @click=\"previewImage\" -->\n    <view class=\"goodsimg\">\n      <image :src=\"goodsdata.coverPicture\" mode=\"heightFix\" />\n    </view>\n\n    <!-- </swiper-item> -->\n    <!-- </swiper> -->\n\n    <scroll-view :scroll-y=\"true\">\n      <view class=\"detail\">\n        <text class=\"price\">{{ goodsdata.price }}积分</text>\n        <view class=\"title-view\">\n          <text class=\"title\">{{ goodsdata.name }}</text>\n          <uni-tag\n            :text=\"`总库存：${goodsdata.allnums}`\"\n            size=\"mini\"\n            :inverted=\"true\"\n            type=\"success\"\n          />\n          <!-- <text >总库存：{{ goodsdata.allnums }}</text> -->\n        </view>\n        <text class=\"text-remark\">{{ goodsdata.introduce }}</text>\n      </view>\n\n      <view class=\"separate\"></view>\n      <!-- sku选择 -->\n      <view class=\"num-box\">\n        <text bindtap=\"toggleDialog\">请选择兑换数量</text>\n        <uni-number-box\n          class=\"numchooseBox\"\n          @blur=\"blur\"\n          :max=\"maxNum\"\n          v-model=\"goodsnum\"\n        ></uni-number-box>\n      </view>\n\n      <view class=\"separate\"></view>\n      <image\n        mode=\"widthFix\"\n        class=\"goodsdimg\"\n        v-for=\"(url, index) in goodsdata.imgs\"\n        :key=\"index\"\n        :src=\"url\"\n        @click=\"previewImage\"\n      />\n      <view class=\"temp\"></view>\n    </scroll-view>\n\n    <view class=\"detail-nav\" :style=\"{ bottom: safeAreaInsets?.bottom!+ 0 + 'px' }\">\n      <view class=\"line_nav\" :style=\"{ height: safeAreaInsets?.bottom!+ 1 + 'px' }\"></view>\n      <view class=\"score-box\">\n        <view class=\"scorenum\">所需积分：</view>\n        <image\n          style=\"border-radius: 20rpx; width: 40rpx; height: 40rpx; margin-top: 10rpx\"\n          src=\"../../static/gifts/R-C.jpg\"\n        />\n        <view class=\"scorenum\">{{ scoreres }}</view>\n      </view>\n      <!-- <button class=\"button-green\" bindtap=\"addCar\" formType=\"submit\">加入购物车</button> -->\n      <button :disabled=\"goodsnum == 0\" class=\"button-red\" @click=\"immeBuy\" formType=\"submit\">\n        立即兑换\n      </button>\n    </view>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n// import { ref, reactive } from 'vue'\n// import { onLoad } from '@dcloudio/uni-app';\n\n// onLoad(() => {\n//   uni.showToast({\n//     title: '礼品中心部分功能尚未实现，敬请期待~',\n//     icon: 'none',\n//     duration: 2000,\n//     complete: function () {\n//       setTimeout(function () {\n//         uni.switchTab({\n//           url: '/pages/index/index'\n//         });\n//       }, 2000); // 在弹窗关闭后，延迟2秒执行页面跳转\n//     }\n//   })\n// })\n\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { ref, computed, watch } from 'vue'\nimport { getGiftDetail, exchangeGift } from '@/services/gift'\nimport { getPersonalInf } from '@/services/personalInf'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n\nconst props = defineProps<{\n  id: number\n}>()\n\nconst getGiftDetails = async (id) => {\n  const res = await getGiftDetail(id)\n  console.log(res.data)\n  goodsdata.value = res.data\n}\nconst getMyCredit = async () => {\n  const res = await getPersonalInf()\n  console.log(res.data.credit)\n  mycredit.value = res.data.credit\n}\nconst mycredit = ref<number>(1)\nconst blur = (e) => {\n  console.log(e)\n  if (e.detail.value > goodsdata.value.allnums) {\n    uni.showToast({\n      title: '兑换数量超出库存',\n      icon: 'none',\n      duration: 1000,\n    })\n  }\n}\nconst maxNum = computed(() => {\n  if (mycredit.value == 0) {\n    return 0\n  }\n  return goodsdata.value.allnums\n})\nconst scoreres = computed(() => {\n  return (goodsnum.value * goodsdata.value.price).toFixed(2)\n})\n// watch([goodsnum.value, () => goodsdata.value.price], ([newgoodsnum]) => {\n//   scoreres.value = newgoodsnum * goodsdata.value.price;\n// });\nconst goodsdata = ref({})\nconst goodsnum = ref<number>(0)\nonShow(() => {\n  if (uni.getStorageSync('token')) {\n    getMyCredit()\n  }\n})\nonLoad(() => {\n  if (uni.getStorageSync('token')) {\n    console.log(props.id)\n    getGiftDetails(props.id)\n    getMyCredit()\n  } else {\n    wx.showToast({\n      title: '您尚未登录，请先登录',\n      icon: 'none',\n      duration: 1000,\n      complete: () => {\n        setTimeout(() => {\n          uni.navigateTo({\n            url: '/pages/login/login',\n          })\n        }, 1000)\n      },\n    })\n  }\n})\n\nconst indicatorDots = true\nconst autoplay = true\nconst interval = 3000\nconst duration = 1000\n\nconst previewImage = (e) => {\n  var current = e.target.dataset.src\n  console.log(current)\n  wx.previewImage({\n    current: current,\n    urls: goodsdata.value.imgs,\n  })\n}\n\nconst applyExchange = async (data) => {\n  const res = await exchangeGift(data)\n  console.log(res)\n  if (res.code == 200) {\n    if (res.data == 3) {\n      uni.showToast({\n        title: '兑换成功！',\n        icon: 'success',\n        duration: 2000,\n        complete: function () {\n          setTimeout(function () {\n            getGiftDetails(props.id)\n            getMyCredit()\n            goodsnum.value = 0\n            // uni.navigateTo({\n            //   url: '/pages/gift/giftCenter',\n            // })\n          }, 2000) // 在弹窗关闭后，延迟2秒执行页面跳转\n        },\n      })\n    }\n    if (res.data == 2) {\n      uni.showToast({\n        title: '余额不足！',\n        icon: 'error',\n        duration: 2000,\n      })\n    }\n    if (res.data == 1) {\n      uni.showToast({\n        title: '库存不足！',\n        icon: 'error',\n        duration: 2000,\n      })\n    }\n  }\n}\nconst immeBuy = () => {\n  console.log('购买')\n  if (mycredit.value < goodsnum.value * goodsdata.value.price) {\n    uni.showToast({\n      title: '剩余积分不足',\n      icon: 'error',\n      duration: 1000,\n    })\n    return\n  }\n  wx.showModal({\n    title: '确认兑换',\n    content: '确定要兑换吗？',\n    success(res) {\n      if (res.confirm) {\n        //用户点击了确认按钮\n        applyExchange({\n          id: null,\n          goodsId: goodsdata.value.id,\n          nums: goodsnum.value,\n        })\n      } else if (res.cancel) {\n        // 用户点击了取消按钮\n        console.log('用户取消了兑换')\n      }\n    },\n  })\n}\n</script>\n<style scoped>\npage {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n/* 直接设置swiper属性 */\nswiper {\n  height: 500rpx;\n}\nswiper-item image {\n  width: 100%;\n  height: 100%;\n}\n.separate {\n  height: 20rpx;\n  background-color: whitesmoke;\n  margin-top: 10rpx;\n  width: 100%;\n}\n.ad_popError {\n  background: #de352d;\n  color: #fff;\n  height: 58rpx;\n  line-height: 58rpx;\n  font-size: 24rpx;\n  text-align: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  z-index: 3;\n}\n.goodsimg {\n  height: 600rpx;\n  width: 100%;\n  display: flex;\n  justify-content: space-around;\n}\n.detail {\n  display: flex;\n  flex-direction: column;\n  margin: 15rpx 10rpx 0;\n}\n.detail .title {\n  font-size: 40rpx;\n  color: black;\n  text-align: justify;\n}\n.detail .price {\n  color: red;\n  font-size: 40rpx;\n  margin: 10rpx;\n  margin-top: 30rpx;\n}\n.title-view {\n  display: flex;\n  justify-content: space-between;\n}\n.line_flag {\n  width: 80rpx;\n  height: 1rpx;\n  display: inline-block;\n  margin: 20rpx auto;\n  background-color: gainsboro;\n  text-align: center;\n}\n.line {\n  width: 100%;\n  height: 2rpx;\n  display: inline-block;\n  margin: 20rpx 0rpx;\n  background-color: gainsboro;\n  text-align: center;\n}\n.detail-nav {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  float: left;\n  background-color: #fff;\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  z-index: 1;\n  width: 100%;\n  height: 100rpx;\n}\n.goodsdimg {\n  margin-bottom: 7px;\n}\n.button-red {\n  background-color: #f44336; /* 红色 */\n}\n.image_detail {\n  width: 100%;\n}\nbutton {\n  z-index: 999;\n  color: white;\n  text-align: center;\n  text-decoration: none;\n  display: inline-block;\n  font-size: 30rpx;\n  border-radius: 0rpx;\n  width: 50%;\n  height: 100%;\n  line-height: 100rpx;\n}\n.detail-nav image {\n  width: 70rpx;\n  height: 50rpx;\n  margin: 20rpx 40rpx;\n}\n.line_nav {\n  width: 100%;\n  background-color: #fff;\n  position: fixed;\n  bottom: 0;\n}\n/* 占位 */\n.temp {\n  height: 100rpx;\n}\ntext {\n  display: block;\n  /* height: 50rpx; */\n  line-height: 50rpx;\n  /* font-size: 30rpx; */\n  margin: 10rpx;\n}\n.text-remark {\n  display: block;\n  font-size: 27rpx;\n}\n.num-box {\n  font-size: 27rpx;\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n}\n.score-box {\n  display: flex;\n  flex-direction: row;\n}\n.scorenum {\n  color: #f44336;\n  display: block;\n  font-size: 30rpx;\n  margin: 10rpx;\n}\n.numchooseBox {\n  margin: auto 0;\n}\n</style>\n","import MiniProgramPage from '/Users/Shared/Files From d.localized/项目储存/Academic-Evening-Tea-zhy_demo/Academic-Evening-Tea-zhy_demo/src/pages/gift/gift.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getGiftDetail","getPersonalInf","ref","computed","onShow","onLoad","wx","exchangeGift"],"mappings":"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"}