{"version":3,"file":"HomeContent.js","sources":["../../../../../../src/pages/index/components/HomeContent.vue","../../../../../../uniComponent:/L1VzZXJzL1NoYXJlZC9GaWxlcyBGcm9tIGQubG9jYWxpemVkL-mhueebruWCqOWtmC9BY2FkZW1pYy1FdmVuaW5nLVRlYS16aHlfZGVtby9BY2FkZW1pYy1FdmVuaW5nLVRlYS16aHlfZGVtby9zcmMvcGFnZXMvaW5kZXgvY29tcG9uZW50cy9Ib21lQ29udGVudC52dWU"],"sourcesContent":["<template>\n  <view class=\"category\">\n    <view class=\"category-item\" @tap=\"tapAct\">\n      <image src=\"../../../static/home/activity.png\" class=\"icon\" />\n      <text class=\"text\">活动发起</text>\n    </view>\n    <navigator\n      :url=\"item.url\"\n      class=\"category-item\"\n      hover-class=\"none\"\n      v-for=\"item in items\"\n      :key=\"item.id\"\n      open-type=\"navigate\"\n    >\n      <image :src=\"item.icon\" class=\"icon\" />\n      <text class=\"text\">{{ item.text }}</text>\n    </navigator>\n  </view>\n  <div class=\"divider\"></div>\n  <view class=\"activity\">\n    <view class=\"activity-box\">\n      <view class=\"activity-box-content\">活动一览</view>\n      <view class=\"activity-box-select\">\n        <uni-data-select\n          v-model=\"status\"\n          :localdata=\"(statusList as any)\"\n          @change=\"change\"\n          placeholder=\"全部\"\n          :clear=\"false\"\n        >\n        </uni-data-select>\n      </view>\n    </view>\n      <view class=\"activity-details\">\n        <navigator\n          class=\"activity-details-item\"\n          v-for=\"item in activities\"\n          :key=\"item.id\"\n          :url=\"`/pages/activity/ActivityDetails?id=${item.id}`\"\n        >\n          <view class=\"activity-details-item-title\">\n            <view class=\"title\">\n              <span class=\"title-content\">\n                {{ item.title }}\n              </span>\n              <view class=\"activity-class\">\n                <uni-tag v-if=\"item.sort == 1\" type=\"primary\" text=\"学术晚茶\" />\n                <uni-tag v-else type=\"success\" text=\"学术社区\" />\n              </view>\n            </view>\n          </view>\n          <view class=\"activity-details-item-contents\">\n            <view class=\"activity-details-item-content\">\n              <view class=\"sponsor\"> 发起学院：{{ item.sponsorCollege }} </view>\n              <view class=\"activity-details-item-content-time\">\n                <image class=\"img\" src=\"../../../static/activity/clock.png\" />{{ item.time }}\n              </view>\n              <view class=\"activity-details-item-content-address\">\n                <image class=\"img\" src=\"../../../static/activity/address.png\" />{{ item.address }}\n              </view>\n            </view>\n            <view class=\"activity-details-item-status\">\n              <view class=\"population\">\n                <image class=\"img\" src=\"../../../static/activity/User.png\"></image\n                >{{ item.population }} / {{ item.limitPopulation }}\n              </view>\n              <view class=\"status\">\n                {{ item.status }}\n              </view>\n            </view>\n          </view>\n        </navigator>\n      </view>\n      <view class=\"loading-text\">\n        <uni-load-more :status=\"finish\"></uni-load-more>\n      </view>\n  </view>\n</template>\n\n<script setup lang=\"ts\">\nimport { getHomeContentAPI, giftIsShow } from '@/services/HomeContent'\nimport { onLoad, onShow, onHide } from '@dcloudio/uni-app'\nimport { ref, reactive } from 'vue'\nconst status = ref<string>('全部')\nconst statusN = ref<Number>(0)\n// 当前所有的页数\nconst pageNum = ref<number>(1)\nconst pageSize= 10\nconst totalNum=ref<number>(0)\nconst finish=ref<string>('more')\n// 表示当前所在的类别\nconst nowList=ref<number>(0)\n// const query = uni.createSelectorQuery().in(this)\n// query.select('.scroll-view').boundingClientRect((data)=>{\n//   this.height=`height:${data.height}px;`;\n// }).exec()\nconst statusList = ref([\n  { value: 0, text: '全部' },\n  { value: 1, text: '进行中' },\n  { value: 2, text: '已结束' },\n  { value: 3, text: '精选' },\n])\nconst change = (e: any,tag=1) => {\n  if(tag===1){\n    finish.value='more'\n    activities.value = []\n    pageNum.value=1\n  }\n  console.log(e)\n  nowList.value=e;\n  if (e === 0) {\n    statusN.value = 0\n    getHomeContent(0, 0, 0,pageNum.value)\n  } else if (e === 1) {\n    statusN.value = 1\n    getHomeContent(1, 2, 1,pageNum.value)\n  } else if (e === 2) {\n    statusN.value = 2\n    getHomeContent(1, 2, 2,pageNum.value)\n  } else {\n    statusN.value = 3\n    getHomeContent(2, 2, 1,pageNum.value)\n  }\n}\ntype Category = {\n  id: number\n  text: string\n  icon: string\n  url: any\n}\ntype Activity = {\n  id: number\n  title: string\n  status: string\n  time: string\n  address: string\n  img?: string\n  // 报名人数和限制人数\n  population?: number\n  limitPopulation?: number\n  // 发起学院\n  sponsorCollege: string\n  // 活动种类\n  sort: number\n}\nconst tapAct = () => {\n  uni.switchTab({ url: '/pages/activity/ActivityLaunch' })\n}\nconst items = ref<Category[]>([\n  {\n    id: 2,\n    text: '活动签到',\n    icon: '../../../static/home/sy-sign_in.png',\n    url: '/pages/activity/ActivitySignIn',\n  },\n  // {\n  //   id: 3,\n  //   text: '礼品中心',\n  //   icon: '../../../static/home/sy-article.png',\n  //   url: '/pages/gift/giftCenter',\n  // },\n  {\n    id: 3,\n    text: '我要推荐',\n    icon: '../../../static/home/sy-video.png',\n    url: '/pages/recommend/recommend',\n  },\n])\nconst gIsShow = ref(false)\nconst giftShow = async () => {\n  const res = await giftIsShow()\n  console.log(res)\n  gIsShow.value = res.data\n  if (gIsShow.value) {\n    items.value = [\n      {\n        id: 2,\n        text: '活动签到',\n        icon: '../../../static/home/sy-sign_in.png',\n        url: '/pages/activity/ActivitySignIn',\n      },\n      {\n        id: 3,\n        text: '礼品中心',\n        icon: '../../../static/home/sy-article.png',\n        url: '/pages/gift/giftCenter',\n      },\n      {\n        id: 4,\n        text: '我要推荐',\n        icon: '../../../static/home/sy-video.png',\n        url: '/pages/recommend/recommend',\n      },\n    ]\n  }\n}\nconst activities = ref<Activity[]>([])\n\nconst getHomeContent = async (type: number, state: number, isEnd: number,pageNum=1,pageSize=10) => {\n  // 获取首页内容\n  let res\n  uni.showLoading({\n    title: '加载中',\n  })\n  finish.value='loading'\n  if (type === 0) {\n    res = await getHomeContentAPI({state:2,pageNum:pageNum,pageSize:pageSize})\n  } else if (type == 1) {\n    res = await getHomeContentAPI({ state: state, isEnd: isEnd,pageNum:pageNum,pageSize:pageSize })\n  } else {\n    res = await getHomeContentAPI({ type: type, state: state,pageNum:pageNum,pageSize:pageSize })\n  }\n  uni.hideLoading()\n  finish.value='more'\n  if (res.code === 200) {\n    totalNum.value=res.total\n    let innerActivities = res.rows.map((item: any) => ({\n      id: item.id,\n      title: item.userImg2,\n      status: item.isEnd == 1 ? '进行中' : '已结束',\n      time: item.lat,\n      address: item.address,\n      sponsorCollege: item.hbKeyword,\n      population: item.hbNum,\n      limitPopulation: item.hot,\n      sort: item.sort,\n    }))\n    activities.value.push(...innerActivities)\n    if (activities.value.length === 0) {\n      uni.showToast({\n        title: '暂无活动',\n        icon: 'none',\n      })\n      finish.value='no-more'\n    }\n    if(pageNum * pageSize >= totalNum.value){\n      finish.value='no-more'\n      // uni.showToast({ icon: 'none', title: '没有更多数据了~' })\n    }\n  } else {\n    uni.showToast({\n      title: '查询失败',\n      icon: 'none',\n    })\n  }\n}\n// 分页查询\nconst onScrolltolower =() => {\n  if(pageNum.value * pageSize >= totalNum.value){\n    finish.value='no-more'\n    return uni.showToast({ icon: 'none', title: '没有更多数据了~' })\n  }else{\n    pageNum.value += 1;\n  }\n  change(nowList.value,2)\n}\nonLoad(() => {\n  giftShow()\n  console.log('onLoad!!!')\n  uni.onNetworkStatusChange((res) => {\n    if (!res.isConnected) {\n      uni.showToast({\n        title: '网络已断开',\n        icon: 'none',\n      })\n    }\n  })\n  getHomeContent(0, 0, 0)\n  uni.$on('scrolltolower', onScrolltolower)\n})\nonHide(() => {})\n// onShow(() => {\n//   if (statusN.value === 0) {\n//     getHomeContent(0, 0, 0)\n//   } else if (statusN.value === 1) {\n//     getHomeContent(1, 2, 1)\n//   } else if (statusN.value === 2) {\n//     getHomeContent(1, 2, 2)\n//   } else {\n//     getHomeContent(2, 2, 1)\n//   }\n// })\n</script>\n\n<style lang=\"scss\">\n.category {\n  margin: 20rpx 0 0;\n  padding: 10rpx 0;\n  display: flex;\n  flex-wrap: nowrap;\n  // min-height: 328rpx;\n  justify-content: space-around;\n\n  .category-item {\n    width: 150rpx;\n    display: flex;\n    justify-content: center;\n    flex-direction: column;\n    align-items: center;\n    box-sizing: border-box;\n\n    .icon {\n      width: 90rpx;\n      height: 90rpx;\n    }\n\n    .text {\n      font-size: 26rpx;\n      color: #666;\n    }\n  }\n}\n\n.divider {\n  width: 90%;\n  height: 1px;\n  background-color: #d6d6d6;\n  margin: 15px auto;\n  margin-bottom: 5px;\n}\n\n.activity {\n  // height: 50%;\n  display: flex;\n  flex-direction: column;\n  min-height: 100rpx;\n  .activity-box {\n    display: flex;\n    justify-content: space-between;\n    width: 90%;\n    margin: 0rpx auto;\n\n    .activity-box-content {\n      font-size: 30rpx;\n      font-weight: bold;\n      padding-top: 20rpx;\n      color: #333;\n    }\n\n    .activity-box-select {\n      float: right;\n      width: 160rpx;\n      z-index: 99;\n    }\n  }\n  \n\n  .activity-details {\n    width: 90%;\n    margin: 20rpx auto;\n\n    .activity-details-item {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: flex-start;\n      width: 100%;\n      padding: 30rpx 0;\n      border-bottom: 1px solid #d6d6d6;\n\n      .activity-details-item-title {\n        font-size: 30rpx;\n        font-weight: bolder;\n        color: #333;\n        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n        margin-bottom: 20rpx;\n        width: 100%;\n        .title {\n          width: 100%;\n          // display: flex;\n          .title-content {\n            // flex: 1;\n            float: left;\n            line-height: 50rpx;\n          }\n          .activity-class {\n            // display: inline;\n            // width: fit-content;\n            // margin-left: 10rpx;\n            float: right;\n            line-height: 50rpx;\n          }\n        }\n      }\n\n      .activity-details-item-contents {\n        display: flex;\n        justify-content: space-between;\n        width: 100%;\n\n        .activity-details-item-content {\n          display: flex;\n          justify-content: center;\n          flex-direction: column;\n          flex: 1;\n\n          .sponsor {\n            margin-bottom: 10rpx;\n            font-size: 30rpx;\n            color: black;\n            margin-bottom: 20rpx;\n          }\n\n          .activity-details-item-content-time {\n            margin-bottom: 10rpx;\n            font-size: 26rpx;\n            color: #767575;\n\n            .img {\n              width: 30rpx;\n              height: 30rpx;\n              margin-right: 10rpx;\n            }\n          }\n\n          .activity-details-item-content-address {\n            font-size: 26rpx;\n            color: #767575;\n\n            .img {\n              width: 30rpx;\n              height: 30rpx;\n              margin-right: 10rpx;\n            }\n          }\n        }\n\n        .activity-details-item-status {\n          display: flex;\n          flex-direction: column;\n          align-items: flex-end;\n          justify-content: space-around;\n          width: 200rpx;\n\n          .population {\n            margin-bottom: 10rpx;\n            font-size: 26rpx;\n            color: #666;\n\n            .img {\n              width: 32rpx;\n              height: 32rpx;\n              margin-right: 10rpx;\n              // color: black;\n            }\n          }\n\n          .status {\n            font-size: 26rpx;\n            color: #666;\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n","import Component from '/Users/Shared/Files From d.localized/项目储存/Academic-Evening-Tea-zhy_demo/Academic-Evening-Tea-zhy_demo/src/pages/index/components/HomeContent.vue'\nwx.createComponent(Component)"],"names":["ref","uni","giftIsShow","pageNum","pageSize","getHomeContentAPI","onLoad","onHide"],"mappings":"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"}